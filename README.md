# 番茄鐘任務管理系統 (Tomato Timer Task Manager)

## 項目概述
這是一個基於 React + TypeScript + Tailwind CSS 開發的番茄鐘任務管理 Web 應用，專注於幫助用戶通過番茄鐘工作法來管理中長期目標和日常任務。

## 核心功能

### 1. 月行事曆主畫面
- **目標任務展示**：在月曆中顯示所有任務及其進度
- **每日番茄鐘統計**：顯示每日完成的番茄鐘數量
- **任務進度可視化**：通過顏色和進度條顯示任務完成狀態

### 2. 新增任務功能
- **任務基本信息**：名稱、描述、截止日期
- **番茄鐘設定**：設定任務需要的番茄鐘數量
- **自動拆分**：將大任務自動拆分成每日可執行的小任務
- **固定任務**：支援設定每日固定任務（如每日學習）

### 3. 番茄鐘計時器
- **40分鐘工作週期**：標準番茄鐘時長
- **計時控制**：開始、暫停、重置功能
- **任務關聯**：計時器與具體任務綁定
- **休息提醒**：工作週期結束後提醒休息

### 4. 統計圖表
- **目標任務進度**：顯示各任務的完成百分比
- **每日番茄鐘趨勢**：展示每日番茄鐘使用趨勢
- **任務排行榜**：最常使用的任務排行
- **月度統計**：月度任務完成情況

### 5. 資料安全保護
- **自動備份機制**：每次資料變更時自動創建備份
- **手動備份功能**：用戶可隨時創建備份
- **備份恢復功能**：支援從備份恢復資料
- **資料健康檢查**：自動檢測資料完整性和關聯性
- **資料匯出/匯入**：支援 JSON 格式的資料遷移
- **資料完整性驗證**：使用哈希值確保備份資料可靠性
- **備份管理**：自動清理舊備份，保留最近5個備份

### 6. 專案標籤管理
- **專案分類**：支援季度目標、年度目標和自定義專案三種類型
- **專案狀態管理**：進行中、已完成、已歸檔三種狀態
- **專案歸檔功能**：將完成的專案歸檔保存，不影響任務使用
- **歸檔資料夾**：專門的歸檔介面，顯示歸檔專案統計信息
- **專案恢復功能**：可隨時從歸檔資料夾恢復專案
- **導航機制**：在專案管理和歸檔資料夾間輕鬆切換
- **篩選和搜尋**：支援按狀態、類型、名稱搜尋專案
- **統計信息**：顯示各類型專案的數量和狀態分布

## 技術架構

### 前端技術棧
- **React 18**：用戶界面框架
- **TypeScript**：類型安全的 JavaScript
- **Tailwind CSS**：實用優先的 CSS 框架
- **Chart.js**：數據可視化圖表庫
- **FullCalendar**：月曆組件（可選）

### 數據存儲
- **localStorage**：本地數據存儲（無需後端）
- **JSON 格式**：結構化數據存儲

### 項目結構
```
src/
├── components/          # React 組件
│   ├── Calendar/       # 月曆相關組件
│   ├── TaskManager/    # 任務管理組件
│   ├── Timer/          # 番茄鐘計時器
│   ├── Charts/         # 統計圖表組件
│   └── UI/             # 通用 UI 組件
├── hooks/              # 自定義 React Hooks
├── types/              # TypeScript 類型定義
├── utils/              # 工具函數
├── data/               # 數據管理
└── styles/             # 樣式文件
```

## 頁面佈局

### 主畫面佈局
```
┌─────────────────────────────────────────────────────────┐
│                     Header (導航欄)                      │
├─────────────────────────────────────────────────────────┤
│  Sidebar (任務列表) │        Main Content               │
│                    │  ┌─────────────────────────────┐   │
│  - 今日任務        │  │      月行事曆主畫面          │   │
│  - 進行中任務      │  │                             │   │
│  - 已完成任務      │  │  [任務進度顯示在日期格中]    │   │
│                    │  │                             │   │
│  ┌─────────────┐   │  └─────────────────────────────┘   │
│  │ 番茄鐘計時器│   │                                     │
│  │             │   │  ┌─────────────────────────────┐   │
│  │ [40:00]     │   │  │      統計圖表區域           │   │
│  │ [開始] [暫停]│   │  │                             │   │
│  └─────────────┘   │  └─────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

### 響應式設計
- **桌面版**：側邊欄 + 主內容區的雙欄佈局
- **平板版**：可折疊側邊欄
- **手機版**：單欄佈局，底部導航

## 數據結構

### 任務數據模型
```typescript
interface Task {
  id: string;
  name: string;
  shortName: string; // 任務簡稱（最多2個中文字）
  description?: string;
  startDate: Date; // 開始日期
  deadline: Date; // 截止日期
  totalPomodoros: number; // 總番茄鐘數
  completedPomodoros: number; // 已完成番茄鐘數
  isDaily: boolean; // 是否為每日固定任務
  dailyPomodoros?: number; // 每日番茄鐘數
  status: 'pending' | 'in-progress' | 'completed';
  createdAt: Date;
  updatedAt: Date;
  color?: string; // 任務顏色標識
  priority?: 'low' | 'medium' | 'high'; // 任務優先級
  subTasks?: SubTask[]; // 子任務列表
  autoSplit: boolean; // 是否自動分解成子任務
}

interface SubTask {
  id: string;
  parentTaskId: string; // 父任務ID
  name: string;
  shortName: string;
  description?: string;
  scheduledDate: Date; // 排程日期
  pomodoros: number; // 需要的番茄鐘數
  completedPomodoros: number; // 已完成的番茄鐘數
  status: 'pending' | 'in-progress' | 'completed';
  createdAt: Date;
  updatedAt: Date;
  color?: string; // 繼承自父任務
  priority?: 'low' | 'medium' | 'high'; // 繼承自父任務
}
```

### 番茄鐘記錄
```typescript
interface PomodoroRecord {
  id: string;
  taskId: string;
  startTime: Date;
  endTime?: Date;
  duration: number; // 分鐘
  status: 'active' | 'completed' | 'paused';
}
```

## 開發指南

### 安裝依賴
```bash
npm install
```

### 啟動開發服務器
```bash
npm run dev
```

### 構建生產版本
```bash
npm run build
```

## 功能實現計劃

### 第一階段：基礎架構
- [x] 項目初始化和技術棧設置
- [x] 基本組件結構設計
- [x] 數據模型定義

### 第二階段：核心功能
- [x] 月曆組件實現
- [x] 任務管理功能
- [x] 番茄鐘計時器
- [x] 數據存儲機制

### 最新更新 (v2.24)
- [x] **即時任務狀態更新** - 工作時間結束時立即更新任務進度，無需等待手動點擊完成
- [x] **自動進度同步** - 當番茄鐘計時完成自動跳轉到休息時間時，任務狀態同步更新
- [x] **優化計時流程** - 分離任務進度更新和計時器停止邏輯，確保進度即時反映
- [x] **修復臨時任務完成狀態問題** - 修復番茄鐘完成後臨時任務進度不更新的問題
- [x] **完善任務完成邏輯** - 當任務達到目標番茄鐘數時自動標記為已完成狀態
- [x] **防止重複計時** - 已完成的任務無法再次開始計時，提供清晰的視覺提示
- [x] **月曆顯示優化** - 臨時任務的完成狀態正確顯示在月曆中，包括黑色圓點和完成進度
- [x] **用戶體驗改進** - 已完成任務在列表中顯示綠色背景和完成標記，無法點擊選擇
- [x] **新增音效提醒功能** - 使用 Web Audio API 生成音效，提供番茄鐘完成、休息開始、休息完成等不同音效
- [x] **音效設定管理** - 在設定頁面可以啟用/禁用音效，並提供音效測試按鈕
- [x] **智能音效播放** - 根據計時器狀態自動播放對應音效，提升用戶體驗
- [x] **音效類型多樣化** - 番茄鐘完成（三聲提示音）、休息開始（兩聲柔和音）、休息完成（一聲長音）、通知音效
- [x] **重要改進：番茄鐘計時器全頁面顯示** - 現在計時器在所有頁面（月曆、任務管理、專案、圖表、設定等）都會保持顯示，確保計時狀態在頁面切換時不會丟失
- [x] **計時器狀態持久化** - 將計時器狀態提升到應用層級，無論用戶切換到哪個頁面，番茄鐘計時都會持續進行
- [x] **統一用戶體驗** - 所有頁面都提供相同的計時器功能，用戶可以在任何頁面開始、暫停或停止番茄鐘計時
- [x] 新增設定頁面，提供完整的應用程式設定管理功能
- [x] 新增時區設定功能，預設為台北時區，解決時區相關問題
- [x] 提供時區工具函數，統一處理所有日期和時間的時區轉換
- [x] 支援多種時區選擇，包括台北、東京、上海、香港、紐約、洛杉磯、倫敦、巴黎、雪梨等
- [x] 放寬任務簡稱和子任務簡稱的字符限制，從2個字符改為4個字符，提供更靈活的命名選擇
- [x] 修復每日固定任務自動生成子任務功能，現在選擇每日任務時會自動為每一天生成可編輯的子任務
- [x] 優化子任務生成邏輯，確保日期格式一致性和正確性
- [x] 改進任務管理流程，每日任務創建後立即顯示對應的子任務
- [x] 增強用戶體驗，提供更清晰的子任務管理界面

### 最新更新 (v2.17)
- [x] 新增專案標籤歸檔功能的返回機制，用戶可以輕鬆從歸檔資料夾返回專案管理頁面
- [x] 優化歸檔資料夾介面，添加返回按鈕和更清晰的導航提示
- [x] 改進頁面標題動態顯示，根據當前狀態顯示對應的標題和描述
- [x] 重置篩選條件功能，返回時自動清除搜尋詞和類型篩選

### 最新更新 (v2.16)
- [x] 新增完整的資料安全保護機制，防止用戶資料丟失
- [x] 實現自動備份功能，每次資料變更時自動創建備份
- [x] 新增資料管理頁面，提供備份、恢復、健康檢查功能
- [x] 支援資料匯出/匯入，方便在不同設備間遷移資料
- [x] 資料完整性驗證，確保備份資料的可靠性

### 最新更新 (v2.15)
- [x] 修正臨時任務日期設定問題，使用本地時區格式確保日期正確
- [x] 解決臨時任務 UI 重疊問題，使用絕對定位避免與番茄鐘 UI 衝突
- [x] 優化臨時任務點擊計時功能，確保可以正常選擇和開始計時
- [x] 改進用戶體驗，提供更好的表單佈局和交互設計

### 最新更新 (v2.14)
- [x] 修正 Vercel 部署 TypeScript 錯誤，移除所有未使用的 pomodoroCount 和 pomodoroRecords 相關代碼
- [x] 優化代碼結構，確保 TypeScript 編譯無錯誤
- [x] 改進日曆組件性能，移除不必要的數據傳遞
- [x] 確保線上版本與本地開發版本完全一致

### 最新更新 (v2.13)
- [x] 優化圖例說明，將「今日」改為「子任務」，將「臨時任務」改為「臨時子任務」
- [x] 在日曆格子中顯示子任務和臨時子任務的完成數量
- [x] 子任務完成後在日曆格子顯示紫色圓圈和完成數量
- [x] 臨時子任務完成後在日曆格子顯示黑色圓圈和完成數量
- [x] 改進臨時子任務數據同步機制，確保日曆能即時顯示完成狀態
- [x] 優化視覺效果，使用不同顏色的圓圈區分不同類型的任務完成情況

### 最新更新 (v2.12)
- [x] 新增臨時任務功能，支持在番茄鐘計時器中快速創建當日臨時任務
- [x] 臨時任務可以設定名稱、簡稱、描述和番茄鐘數量
- [x] 臨時任務只能在當天創建和使用，確保任務的即時性
- [x] 在番茄鐘計時器中顯示今日臨時任務列表，方便快速選擇
- [x] 臨時任務以橙色邊框顯示，與普通任務和子任務區分
- [x] 支持臨時任務的番茄鐘計時和進度追蹤
- [x] 優化用戶體驗，提供快速創建和開始計時的流程

### 最新更新 (v2.11)
- [x] 重新設計子任務功能，支持手動創建和編輯子任務
- [x] 新增子任務管理界面，可以為每個子任務設定詳細內容
- [x] 子任務可以設定不同的工作內容、排程日期和番茄鐘數量
- [x] 在月曆中以紫色邊框顯示子任務，與普通任務區分
- [x] 側邊欄同時顯示今日任務和子任務
- [x] 任務詳情頁面添加"管理子任務"按鈕
- [x] 子任務支持獨立進行番茄鐘計時

### 最新更新 (v2.10)
- [x] 完善子任務顯示功能，在月曆、側邊欄和任務管理中都能看到子任務
- [x] 新增自動分解子任務選項，用戶可以選擇是否將大任務自動分解
- [x] 子任務在月曆中以紫色邊框顯示，與普通任務區分
- [x] 任務詳情頁面顯示子任務列表和進度
- [x] 側邊欄同時顯示今日任務和子任務
- [x] 優化子任務的視覺識別和用戶體驗

### 最新更新 (v2.9)
- [x] 新增子任務系統，支持將大任務自動分解成每日可執行的子任務
- [x] 子任務獨立管理，可以單獨編輯、刪除和進行番茄鐘計時
- [x] 嚴格限制番茄鐘計時，只能選擇當日的任務或子任務
- [x] 改善任務分解邏輯，確保子任務按日期正確分配
- [x] 優化數據結構，支持父子任務關係管理

### 最新更新 (v2.8)
- [x] 新增番茄鐘任務選擇限制，只能選擇當日的任務進行計時
- [x] 優化任務選擇邏輯，防止選擇非當日任務
- [x] 添加視覺提示，清楚標示哪些任務可以進行番茄鐘計時
- [x] 改善用戶體驗，確保番茄鐘計時的有效性和專注度

### 最新更新 (v2.7)
- [x] 修復今天日期顯示錯誤問題，解決時區導致的日期偏移
- [x] 優化 isToday 和 isYesterday 函數，使用本地時間比較
- [x] 確保今天日期粗框正確顯示在實際今天日期上
- [x] 改善日期比較的準確性和可靠性

### 最新更新 (v2.6)
- [x] 優化日期比較邏輯，確保跨年任務正確顯示
- [x] 改善月曆任務篩選的準確性
- [x] 支持未來日期任務的顯示

### 最新更新 (v2.5)
- [x] 修復拼音輸入法兼容性問題，允許完整輸入拼音
- [x] 優化簡稱輸入體驗，支持實時提示和自動截取
- [x] 改善表單驗證邏輯，確保數據完整性

### 最新更新 (v2.4)
- [x] 新增任務簡稱功能，支持最多2個中文字
- [x] 行事曆顯示任務簡稱，提升可讀性
- [x] 任務列表和側邊欄顯示簡稱標籤
- [x] 改善任務識別和管理的便利性

### 最新更新 (v2.3)
- [x] 為週末日期添加透明紅色背景，提升視覺識別度
- [x] 更新月曆圖例說明，包含週末標識
- [x] 改善月曆的視覺層次和可讀性

### 最新更新 (v2.2)
- [x] 優化頁面佈局，番茄鐘計時器只在月曆頁面顯示
- [x] 任務管理和統計圖表頁面使用全寬佈局
- [x] 改善用戶體驗，減少不必要的界面元素
- [x] 優化不同頁面的專注度

### 最新更新 (v2.1)
- [x] 修復日期處理錯誤，解決 `date.toLocaleDateString is not a function` 問題
- [x] 修復 localStorage 數據讀取時缺少 startDate 轉換的問題
- [x] 為所有日期相關函數添加防護措施，處理無效日期
- [x] 優化錯誤處理，提升應用穩定性
- [x] 確保所有日期操作的安全性

### 最新更新 (v2.0)
- [x] 新增任務開始日期功能，完善任務時間管理
- [x] 更新任務表單，支持設置開始日期和截止日期
- [x] 添加日期邏輯驗證，確保開始日期不晚於截止日期
- [x] 更新任務列表顯示，同時顯示開始和截止日期
- [x] 優化月曆和側邊欄的任務篩選邏輯，使用時間範圍
- [x] 改善任務的時間管理體驗

### 最新更新 (v1.9)
- [x] 修復右側計時器滾動問題，設置固定高度 h-[calc(100vh-4rem)]
- [x] 進一步優化計時器內容佈局，減少間距和字體大小
- [x] 確保計時器完全固定不滾動，內容緊湊顯示
- [x] 改善計時器視覺效果和空間利用率
- [x] 解決計時器區域的滾動問題

### 最新更新 (v1.8)
- [x] 優化主內容區域佈局，中間欄可滾動，右邊欄固定
- [x] 中間欄添加 overflow-y-auto 支持垂直滾動
- [x] 右邊欄添加 overflow-hidden 防止滾動
- [x] 改善整體頁面佈局和用戶體驗
- [x] 確保各區域功能獨立且互不干擾

### 最新更新 (v1.7)
- [x] 右側欄位改為固定不滾動佈局
- [x] 優化計時器內容配置，使用 flex-shrink-0 固定各區塊
- [x] 調整字體大小和間距，提升空間利用率
- [x] 計時器顯示區域使用 flex-1 自適應剩餘空間
- [x] 改善整體視覺平衡和用戶體驗

### 最新更新 (v1.6)
- [x] 優化右側計時器佈局，設置固定高度400px
- [x] 改善計時器顯示區域的空間利用
- [x] 提升計時器視覺效果和用戶體驗
- [x] 確保計時器組件佈局更加合理

### 最新更新 (v1.5)
- [x] 修復月曆顯示不完整問題，移除高度限制
- [x] 優化任務名稱顯示，只顯示第一個字節省空間
- [x] 改善月曆佈局，支持自然延伸和滾動
- [x] 提升月曆可讀性，任務狀態更清晰
- [x] 確保月曆完整顯示所有日期

### 最新更新 (v1.4)
- [x] 優化側邊欄滾動體驗，整個側邊欄內容可滾動
- [x] 移除複雜的 flex 佈局，簡化側邊欄結構
- [x] 統一所有側邊欄區塊的邊框樣式
- [x] 改善滾動性能，提升用戶體驗
- [x] 確保所有內容都能完整顯示和滾動

### 最新更新 (v1.3)
- [x] 修復頁面高度限制問題，移除固定高度約束
- [x] 將頁面佈局改為自然延伸，支持內容滾動
- [x] 優化側邊欄高度計算，使用 calc(100vh - 4rem)
- [x] 改善主內容區域佈局，支持內容自然延伸
- [x] 確保右側計時器區域不會被壓縮 (flex-shrink-0)
- [x] 今日任務區域完整顯示，支持滾動查看所有任務

### 最新更新 (v1.2)
- [x] 優化側邊欄佈局，確保今日任務完整顯示
- [x] 改善側邊欄空間分配，固定高度區塊使用 flex-shrink-0
- [x] 今日任務區域使用 flex-1 和 overflow-y-auto，支持滾動
- [x] 移除任務數量限制，顯示所有今日任務
- [x] 改善空狀態顯示，增加視覺提示
- [x] 使用 sticky 標題，提升用戶體驗

### 第三階段：統計功能
- [ ] Chart.js 圖表集成
- [ ] 進度統計實現
- [ ] 數據可視化

### 第四階段：優化和完善
- [ ] 響應式設計優化
- [ ] 用戶體驗改進
- [ ] 性能優化

## 瀏覽器兼容性
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## 貢獻指南
1. Fork 項目
2. 創建功能分支
3. 提交更改
4. 發起 Pull Request

## 授權
MIT License 